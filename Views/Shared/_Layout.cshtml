<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Almapac</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Font Awesome 7.1.0 -->
    <link href="https://cdn.jsdelivr.net/npm/@@fortawesome/fontawesome-free@@6.1.0/css/all.min.css" rel="stylesheet">
    <!-- Tipo de letra -->
    <link href="https://fonts.cdnfonts.com/css/gilroy-bold" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="~/css/site.css" />
    <!-- CSS personalizado de cada p√°gina -->
    @RenderSection("Styles", required: false)
</head>
<body>
    <!-- Header Compartido -->
    @await Html.PartialAsync("_Header")

    <!-- Contenido espec√≠fico de cada p√°gina -->
    <div class="flex-grow">
        @RenderBody()
    </div>

    <!-- Footer Compartido -->
    @await Html.PartialAsync("_Footer")

    <!-- Spinner overlay (componente compartido) -->
    @await Html.PartialAsync("_Spinner")

    <!-- Scripts necesarios de Bootstrap y jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <!-- SweetAlert2 (latest version) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.all.min.js"></script>

    <!-- Custom Scripts -->
    <script src="https://rawcdn.githack.com/nextapps-de/spotlight/0.5.5/dist/spotlight.cdn.js"></script>

    <!-- LightGallery and Plugins -->
    <script src="https://cdn.rawgit.com/sachinchoolur/lightgallery.js/master/dist/js/lightgallery.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-pager.js/master/dist/lg-pager.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-autoplay.js/master/dist/lg-autoplay.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-fullscreen.js/master/dist/lg-fullscreen.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-zoom.js/master/dist/lg-zoom.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-hash.js/master/dist/lg-hash.js"></script>
    <script src="https://cdn.rawgit.com/sachinchoolur/lg-share.js/master/dist/lg-share.js"></script>
        <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="~/js/site.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2"></script>
    <script>
        // Registrar el plugin de zoom/pan cuando se carga por CDN
        (function () {
            const zoomPlugin = window['chartjs-plugin-zoom'] || window.ChartZoom;
            if (zoomPlugin) Chart.register(zoomPlugin);
        })();
    </script>

    <!-- Script de persistencia de pesta√±as -->
    <script src="~/js/tab-persistence.js"></script>

    <!-- üîê Helper de permisos global (carga datos desde servidor) -->
    <script src="~/js/permission-helper.js"></script>

    <!-- Funci√≥n de navegaci√≥n con persistencia -->
    <script>
        // Funci√≥n para navegar respetando la preferencia de pesta√±a
        function navigateWithTabPreference(event, azucarUrl, melazaUrl) {
            event.preventDefault();
            
            // Obtener preferencia guardada
            const selectedTab = window.TabPersistence ? 
                               window.TabPersistence.getSelectedTab() : 
                               'azucar';
            
            // Decidir URL seg√∫n preferencia
            const targetUrl = selectedTab === 'melaza' ? melazaUrl : azucarUrl;
            
            console.log('Navegando con preferencia:', selectedTab, '‚Üí', targetUrl);
            
            // Navegar
            window.location.href = targetUrl;
            
            return false;
        }
    </script>

    <!-- Scripts espec√≠ficos de cada p√°gina -->
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>